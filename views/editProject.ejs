<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Edit Project</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheets/editProject-style.css">
  </head>
  <body >
    <%- include('navbar') %>
    <br/>
    <br/>
    <br/>
    <br/>
    <div class="container d-flex justify-content-center align-items-center min-vh-100">    
        <div class="row border rounded-5 p-2 mb-5 shadow box-area">
          <div class="header-text mb-1 editProjectPageTitle">
            <br/>
            <figure class="text-center"><p>Edit Project</p></figure>
          </div>
          <div class="container">
            <div class="row">
              <div class="col md-12 p-0 pt-4 pb-4">
                  <form action="#" class="p-4 m-auto" id="editProjectForm">
                      <div class="row">
                          <div class="col-md-12">
                            <div class="header-text mb-1 enterTitle">
                              <figure class="text-left"><p>Title:</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <input type="text" id="title" name="title" value="<%= project.title %>" class="form-control form-control-lg bg-white fs-5" required placeholder = "Project Title">
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="header-text mb-1 enterSchool">
                              <figure class="text-left"><p>School:</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <input type="text" id="school" name="school" value="<%= project.school %>" disabled class="form-control form-control-lg bg-white fs-5" required placeholder = "Name of School">
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="header-text mb-1 enterDescription">
                              <figure class="text-left"><p>Description:</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <textArea rows="5" required class="form-control form-control-lg bg-white" placeholder="Project Description" id="description" name="description"><%= project.description %></textArea>
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="header-text mb-1 enterGoal">
                              <figure class="text-left"><p>Goal Money:</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <input type="number" id="goalmoney" name="goalmoney" value="<%= project.goalmoney %>" class="form-control form-control-lg bg-white fs-5" required >
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="header-text mb-1 currentMoney">
                              <figure class="text-left"><p>Current Money:</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <input type="number" id="currentmoney" name="currentmoney" value="<%= project.currentmoney %>" disabled class="form-control form-control-lg bg-white fs-5">
                            </div>
                          </div>
                          <div class="col-md-12 mb-4">
                            <div class="header-text mb-1 selectStatus">
                              <figure class="text-left"><p>Status</p></figure>
                            </div>
                            <div class="input-group mb-5 w-100">
                              <select id="status" name="status" class="form-select form-select-lg bg-white fs-5" required>
                                <option value="proposed" <% if (project.status === "proposed") { %>selected<% } %> >Proposed</option>
                                <option value="open" <% if (project.status === "open") { %>selected<% } %> >Open</option>
                                <option value="closed" <% if (project.status === "closed") { %>selected<% } %> >Closed</option>
                              </select>
                            </div>
                          </div>
                          <button type="submit" class="btn btn-project-submit btn-lg btn-block mt-3"><i class="bi bi-floppy2"></i>&nbsp; Save Changes</button>
                      </div>
                  </form>
          
                  <form action="#" class="p-4 m-auto" id="deleteProjectForm">
                    <button type="submit" class="btn btn-project-delete btn-lg btn-block mt-3"><i class="bi bi-trash3"></i> Delete Project</button>
                  </form>
               
              </div>
              
          </div>
      </div>
    </div>
      
    <br/>
    <br/>
   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  </body>
  <script>
    var form = document.getElementById("editProjectForm");
    async function sendCreateProject(event) {
      event.preventDefault();
      var title = document.getElementById("title").value;
      var description = document.getElementById("description").value;
      var goalmoney = document.getElementById("goalmoney").value;
      var status = document.getElementById("status").value;

      // Post-Request to Edit Project
      var response = await fetch("/projects/edit/<%= project.projectid %>", {
        method: "POST",
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title: title,
          description: description,
          goalmoney: goalmoney,
          status: status,
          firebtoken: localStorage.getItem("firebtoken")
        })
      });

      var json = await response.json();
      console.log(json);

      if (response.status == 200) {
        console.log("Success edit Project");
        window.location.href = "/projects/view/" + json.projectid;
      } else {
        alert("Tried but failed to edit project");
        console.log(json.msg);
      }
    }
    form.addEventListener("submit", sendCreateProject);

    var deleteForm = document.getElementById("deleteProjectForm");
    async function sendDeleteProject(event) {
      event.preventDefault();
      var response = await fetch("/projects/delete/<%= project.projectid %>", {
        method: "POST",
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          firebtoken: localStorage.getItem("firebtoken")
        })
      });

      var json = await response.json();
      console.log(json);

      if (response.status == 200) {
        console.log("Success delete Project");
        window.location.href = "/projects";
      } else {
        alert("Tried but failed to delete project");
        console.log(json.msg);
      }
    }
    deleteForm.addEventListener("submit", sendDeleteProject);

  </script>  
</html>
